# Using Z3 solver for optimization problems

Solve complex constraint problems with z3-solver in #Python ðŸ‘‡

```python
# /// script
# dependencies = [
#   "z3-solver",
# ]
# ///
import z3

def solve_button_puzzle(buttons: list[tuple[int, ...]], target: list[int]) -> int:
    """Find minimum button presses to reach target state.

    Each button affects multiple counters when pressed.
    Find minimum total presses to reach exact target values.
    """
    optimizer = z3.Optimize()

    # Create variables for number of times each button is pressed
    presses = [z3.Int(f"button_{i}") for i in range(len(buttons))]

    # Constraint: can't press negative times
    for p in presses:
        optimizer.add(p >= 0)

    # Constraint: each counter must equal its target
    for counter_idx, target_value in enumerate(target):
        total = sum(
            presses[btn_idx]
            for btn_idx, button in enumerate(buttons)
            if counter_idx in button
        )
        optimizer.add(total == target_value)

    # Minimize total presses
    optimizer.minimize(sum(presses))
    optimizer.check()

    return optimizer.model().eval(sum(presses)).as_long()

# Example:
buttons = [(0, 1), (1, 2), (0, 2)]  # Which counters each button affects
target = [3, 5, 2]  # Desired counter values
print(solve_button_puzzle(buttons, target))
```

#z3 #optimization
